# dns

>域名解析（DNS）的基本原理是把网络地址（域名，以一个字符串的形式）对应到真实的计算机能够识别的网络地址（IP地址，比如216.239.53.99 这样的形式），以便计算机能够进一步通信，传递网址和内容等。查询端口53

## 查询过程

1. 客户端（浏览器）发送一个域名（例如www.tungee.com）解析请求，先检查浏览器缓存中有没有对应域名解析的IP地址，如果有直接返回。

2. 如果用户浏览器缓存没有查到的话，会先到操作系统的hosts文件中查找（听说ios设备没有该步骤，待验证），有对应的域名IP地址的话直接返回。

3. 如果本地hosts文件没有查到，会向外网的本地区域名服务器（Local DNS）发起查询请求，本地服务器收到请求之后，会先查询本地缓存，如果有的话会直接返回。

    >本地区域名服务器通常性能都会很好，它们一般都会缓存域名解析结果，当然缓存时间是受域名的失效时间控制的，一般缓存空间不是影响域名失效的主要因素。大约90%的域名解析都到这里就已经完成了，所以LDNS主要承担了域名的解析工作。

4. 根域名服务器告诉本地域名服务器，下一次应该查询的顶级域名服务器的IP地址。

后续的还是看下面这段吧

假设一台主机想知道y.abc.com这个域名的IP地址，那么整个的查询过程如下：

主机先向其本地域名服务器进行递归查询
本地域名服务器采用迭代的查询，它先向根域名服务器查询
根域名服务器告诉本地域名服务器，**下一次应该查询的顶级域名服务器的IP地址。**

本地域名服务器向顶级域名服务器发起查询。
顶级域名服务器告诉本地域名服务器，**下一次应查询的权限域名服务器IP地址**

本地域名服务器向权限域名服务器发起查询。
权限域名服务器告诉本地域名服务器所查询的IP地址。
本地域名服务器把查询结果告诉主机

## 域名的层级

从查询的步骤来看,域名是有层级的。

举个例子来说,www.tungee.com 真正的域名是www.tungee.com.root
因为所有的域名的根域名都是.root 所以默认都是省掉的

根域名的下一级叫做‘顶级域名’（top-level domain），比如.com .net
再下一级则是"次级域名"（second-level domain），比如www.tungee.com里面的tungee,这级域名用户是可以注册的。
再下一级是主机名（host），比如www.tungee.com里面的www，又称为"三级域名"，这是用户在自己的域里面为服务器分配的名称，是用户可以任意分配的。

>主机名.次级域名.顶级域名.根域名
www.tungee.com.root

链接：<https://juejin.cn/post/6844903863623876622>

## 常见的DNS域名劫持方式及解决方法

>DNS劫持（DNS Hijacking）：又被称为域名劫持，DNS重定向（DNS direaction）,是一种DNS攻击方式。即是DNS查询没有得到正确的解析，以致引导user访问到恶意的网站，从而窃取用户隐私，或者进行某些恶意的操作。

DNS劫持最直接的手段是通过入侵 DNS 服务器，获取攻击目标域名的解析记录控制权，之后修改攻击目标域名的解析结果，等到 TTL 时间生效之后，所有对该域名的访问由原 IP 地址指向修改后的恶意 IP。DNS 劫持的后果就是对被修改域名记录的网址不能访问， 甚至访问到虚假网址，导致用户数据被盗、被挂马的严重危害。

通常的 DNS 查询没有强大的认证机制作为安全保证，而且 DNS 查询通常基于无连接 不可靠的 UDP 协议，因此 DNS 的查询非常容易被篡改，通过对 UDP 端口 53 上的 DNS 查 询进行侦听，一经发现与关键词相匹配的请求，则立即伪装成目标域名的解析服务器（NS， Name Server）给查询者返回虚假结果，从而实现窃取资料或者破坏原有正常服务的目的。 还有一种手段是黑客伪造权威 DNS 服务器的应答，对缓存 DNS 服务器进行污染。

1. 本机DNS劫持
攻击者通过某些手段使用户的计算机感染上木马病毒，或者恶意软件之后，恶意修改本地DNS配置，比如修改本地hosts文件，缓存等
2. 路由DNS劫持
很多用户默认路由器的默认密码，攻击者可以侵入到路由管理员账号中，修改路由器的默认配置
3. 攻击DNS服务器
直接攻击DNS服务器，例如对DNS服务器进行DDOS攻击，可以是DNS服务器宕机，出现异常请求，还可以利用某些手段感染dns服务器的缓存，使给用户返回来的是恶意的ip地址
4. 用 HTTP DNS 代替 Local DNS

### 防范

1.加强本地计算机病毒检查，开启防火墙等，防止恶意软件，木马病毒感染计算机
2.改变路由器默认密码，防止攻击者修改路由器的DNS配置指向恶意的DNS服务器
3.企业的话可以准备两个以上的域名，一旦一个域名挂掉，还可以使用另一个
4.用HTTP DNS 代替 Local DNS
